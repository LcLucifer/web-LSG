<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - Love Skin Glow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #000000 0%, #3c3c3c 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background-color: #000000;
            color: #FFD700;
            padding: 1rem 2rem;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .logout-btn {
            background-color: #c62828;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .logout-btn:hover {
            background-color: #8b0000;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .stat-card h3 {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 2.5rem;
            color: #FFD700;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-change {
            font-size: 0.85rem;
            color: #4caf50;
        }

        .stat-change.negative {
            color: #c62828;
        }

        .chart-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        .chart-container h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .chart-row {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .chart-label {
            min-width: 150px;
            color: #333;
            font-weight: 500;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 40px;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        .chart-bar-value {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .table-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            overflow-x: auto;
        }

        .table-container h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: #f5f5f5;
            color: #333;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #FFD700;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            color: #666;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        .category-badge {
            display: inline-block;
            background-color: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 3px;
            font-size: 0.8rem;
        }

        .price-badge {
            color: #FFD700;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .nav-btn {
            background-color: white;
            color: #333;
            padding: 10px 20px;
            border: 2px solid #FFD700;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background-color: #FFD700;
            color: #000;
        }

        .nav-btn.active {
            background-color: #FFD700;
            color: #000;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 15px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .chart-bar {
                width: 100%;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">üìä Analytics - LSG</div>
            <button class="logout-btn" onclick="handleLogout()">Logout</button>
        </header>

        <div class="nav-buttons">
            <a href="products.html" class="nav-btn">‚Üê Kembali ke Produk</a>
            <a href="shop.html" class="nav-btn">üõçÔ∏è Toko</a>
            <a href="LSG.html" class="nav-btn">üè† Beranda</a>
        </div>

        <div class="dashboard-grid">
            <div class="stat-card">
                <h3>Total Produk</h3>
                <div class="stat-value" id="totalProducts">0</div>
                <div class="stat-change">Semua produk Anda</div>
            </div>
            <div class="stat-card">
                <h3>Total Stok</h3>
                <div class="stat-value" id="totalStock">0</div>
                <div class="stat-change">Unit tersedia</div>
            </div>
            <div class="stat-card">
                <h3>Nilai Inventory</h3>
                <div class="stat-value" id="totalValue">Rp 0</div>
                <div class="stat-change">Total harga stok</div>
            </div>
            <div class="stat-card">
                <h3>Harga Rata-rata</h3>
                <div class="stat-value" id="avgPrice">Rp 0</div>
                <div class="stat-change">Per produk</div>
            </div>
        </div>

        <div class="chart-container">
            <h2>üì¶ Distribusi Stok Per Kategori</h2>
            <div id="categoryChart"></div>
        </div>

        <div class="chart-container">
            <h2>üí∞ Nilai Inventory Per Kategori</h2>
            <div id="valueChart"></div>
        </div>

        <div class="table-container">
            <h2>üìã Detail Produk Anda</h2>
            <table id="productTable">
                <thead>
                    <tr>
                        <th>Nama Produk</th>
                        <th>Kategori</th>
                        <th>Harga</th>
                        <th>Stok</th>
                        <th>Total Nilai</th>
                        <th>Tanggal Dibuat</th>
                    </tr>
                </thead>
                <tbody id="productBody">
                    <tr><td colspan="6" class="no-data">Tidak ada produk</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let currentUser = null;
        let userProducts = [];

        window.addEventListener('load', () => {
            const loggedInUser = sessionStorage.getItem('loggedInUser');
            
            if (!loggedInUser) {
                alert('Anda harus login terlebih dahulu!');
                window.location.href = 'login.html';
                return;
            }

            currentUser = JSON.parse(loggedInUser);
            loadAnalytics();
        });

        function loadAnalytics() {
            const allProducts = JSON.parse(localStorage.getItem('products')) || [];
            userProducts = allProducts.filter(p => p.createdBy === currentUser.email);

            // Calculate statistics
            const totalProducts = userProducts.length;
            const totalStock = userProducts.reduce((sum, p) => sum + p.stock, 0);
            const totalValue = userProducts.reduce((sum, p) => sum + (p.price * p.stock), 0);
            const avgPrice = totalProducts > 0 ? Math.floor(totalValue / totalProducts) : 0;

            // Update stat cards
            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('totalStock').textContent = totalStock;
            document.getElementById('totalValue').textContent = 'Rp ' + totalValue.toLocaleString('id-ID');
            document.getElementById('avgPrice').textContent = 'Rp ' + avgPrice.toLocaleString('id-ID');

            // Load charts
            loadCategoryChart();
            loadValueChart();
            loadProductTable();
        }

        function loadCategoryChart() {
            const categories = {};

            userProducts.forEach(product => {
                if (!categories[product.category]) {
                    categories[product.category] = 0;
                }
                categories[product.category] += product.stock;
            });

            const chartContainer = document.getElementById('categoryChart');
            
            if (Object.keys(categories).length === 0) {
                chartContainer.innerHTML = '<div class="no-data">Tidak ada data kategori</div>';
                return;
            }

            const maxStock = Math.max(...Object.values(categories));
            
            chartContainer.innerHTML = Object.entries(categories).map(([category, stock]) => {
                const percentage = (stock / maxStock) * 100;
                return `
                    <div class="chart-row">
                        <div class="chart-label">${category}</div>
                        <div class="chart-bar" style="width: ${percentage}%">
                            <div class="chart-bar-value">${stock} unit</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadValueChart() {
            const categories = {};

            userProducts.forEach(product => {
                if (!categories[product.category]) {
                    categories[product.category] = 0;
                }
                categories[product.category] += (product.price * product.stock);
            });

            const chartContainer = document.getElementById('valueChart');
            
            if (Object.keys(categories).length === 0) {
                chartContainer.innerHTML = '<div class="no-data">Tidak ada data nilai</div>';
                return;
            }

            const maxValue = Math.max(...Object.values(categories));
            
            chartContainer.innerHTML = Object.entries(categories).map(([category, value]) => {
                const percentage = (value / maxValue) * 100;
                return `
                    <div class="chart-row">
                        <div class="chart-label">${category}</div>
                        <div class="chart-bar" style="width: ${percentage}%">
                            <div class="chart-bar-value">Rp ${(value / 1000000).toFixed(1)}M</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadProductTable() {
            const tbody = document.getElementById('productBody');

            if (userProducts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="no-data">Tidak ada produk</td></tr>';
                return;
            }

            tbody.innerHTML = userProducts.map(product => {
                const totalValue = product.price * product.stock;
                return `
                    <tr>
                        <td><strong>${product.name}</strong></td>
                        <td><span class="category-badge">${product.category}</span></td>
                        <td><span class="price-badge">Rp ${product.price.toLocaleString('id-ID')}</span></td>
                        <td>${product.stock} unit</td>
                        <td><span class="price-badge">Rp ${totalValue.toLocaleString('id-ID')}</span></td>
                        <td>${product.createdDate}</td>
                    </tr>
                `;
            }).join('');
        }

        function handleLogout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                sessionStorage.removeItem('loggedInUser');
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>
